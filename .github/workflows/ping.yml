name: Ping Streamlit App

on:
  schedule:
    - cron: '0 * * * *'  # Cada 1 hora
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Hacer ping con headers personalizados
        id: ping
        run: |
          echo "Haciendo ping a la app con headers simulando navegador..."
          STATUS_CODE=$(curl -s -o /dev/null -w "%{http_code}" -H "User-Agent: Mozilla/5.0" https://santifederico-santa-maria-app-pssjxi.streamlit.app//)
          echo "Código de respuesta: $STATUS_CODE"
          echo "::set-output name=status_code::$STATUS_CODE"

      - name: Notificar por Telegram si falla
        if: steps.ping.outputs.status_code != '200'
        run: |
          STATUS_CODE="${{ steps.ping.outputs.status_code }}"
          MENSAJE="⚠️ La app Streamlit respondió con un error (HTTP $STATUS_CODE). Revisá: https://santifederico-santa-maria-app-pssjxi.streamlit.app/"
          curl -s -X POST https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage \
            -d chat_id=${{ secrets.TELEGRAM_CHAT_ID }} \
            -d text="$MENSAJE"